<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Project Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <style> .progress { height: 20px; } .stretch-unlocked { color: #198754; } </style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container" th:if="${project}">
    <div class="row">
        <div class="col-md-8">
            <h3 th:text="${project.name}"></h3>
            <p class="text-muted">หมวดหมู่: <span th:text="${project.category}"></span> • หมดเขต: <b th:text="${project.deadline}"></b></p>

            <div class="mb-3">
                <div class="d-flex justify-content-between">
                    <div>เป้าหมาย: <b th:text="${#numbers.formatDecimal(project.goalAmount,1,0)}"></b> บาท</div>
                    <div>ระดมแล้ว: <b th:text="${#numbers.formatDecimal(project.currentRaised,1,0)}"></b> บาท</div>
                </div>
                <div class="progress mt-1">
                    <div class="progress-bar" role="progressbar" th:style="${'width:'+progress+'%'}" th:text="${progress + '%'}"></div>
                </div>
            </div>

            <div class="mb-4">
                <h5>Stretch Goals</h5>
                <div th:if="${!hasStretch}">ไม่มีเป้าหมายเพิ่มเติม</div>
                <ul class="list-group" th:if="${hasStretch}">
                    <li class="list-group-item d-flex justify-content-between align-items-center" th:each="sg : ${project.stretchGoals}">
                        <div>
                            <div class="fw-semibold" th:text="${sg.description}"></div>
                            <div class="small text-muted">ปลดล็อกเมื่อถึง
                                <span th:text="${#numbers.formatDecimal(sg.thresholdAmount,1,0)}"></span> บาท</div>
                        </div>
                        <span class="badge bg-success" th:if="${project.currentRaised >= sg.thresholdAmount}">ปลดล็อกแล้ว</span>
                        <span class="badge bg-secondary" th:unless="${project.currentRaised >= sg.thresholdAmount}">ยังไม่ปลดล็อก</span>
                    </li>
                </ul>
            </div>

            <div class="mb-4">
                <h5>สถิติ</h5>
                <p class="mb-0">จำนวนครั้งที่ถูกปฏิเสธ: <b th:text="${project.rejectedPledges}"></b></p>
            </div>
        </div>
        <div class="col-md-4">
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">สนับสนุนโครงการนี้</h5>
                    <form method="post" th:action="@{'/projects/' + ${project.id} + '/pledge'}">
                        <div class="mb-3">
                            <label class="form-label">จำนวนเงิน (บาท)</label>
                            <input class="form-control" name="amount" type="number" step="1" min="1" required />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">เลือกระดับรางวัล (ไม่บังคับ)</label>
                            <select class="form-select" name="rewardTierId">
                                <option value="">-- ไม่เลือกรางวัล --</option>
                                <option th:each="rt : ${project.rewardTiers}"
                                        th:value="${rt.id}"
                                        th:text="${rt.name + ' • ขั้นต่ำ ' + #numbers.formatDecimal(rt.minAmount,1,0) + ' • คงเหลือ ' + rt.remainingQuota}"
                                        th:disabled="${rt.remainingQuota == 0}"></option>
                            </select>
                        </div>
                        <button class="btn btn-primary w-100">สนับสนุน</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <a class="btn btn-link" th:href="@{/projects}">กลับหน้ารวม</a>
    </div>
</div>

</body>
<script th:src="@{/js/app.js}"></script>
</html>
